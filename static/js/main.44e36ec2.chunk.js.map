{"version":3,"sources":["assets/sounds/808s_stand_out.ogg","assets/sounds/Kicking_away.mp3","assets/sounds/Problems_away.flac","App.js","../../src/index.js","index.js"],"names":["module","exports","App","ref","React","createRef","useState","name","author","src","sound1","thumbnail","sound2","sound3","playList","index","setIndex","isPlaying","setIsPlaying","next","length","previous","useEffect","console","log","ReactDom","findDOMNode","current","play","pause","isPipToggled","updatePip","initialImage","onPlay","onPause","onPrevious","onNext","setIsToggled","thumb","canvas","document","video","togglePip","a","navigator","useAudioPictureInPicture","className","target","href","style","width","onEnded","onClick","fontSize","ReactDOM","render","getElementById"],"mappings":"qHAAAA,EAAOC,QAAU,IAA0B,4C,gBCA3CD,EAAOC,QAAU,IAA0B,0C,gBCA3CD,EAAOC,QAAU,IAA0B,4C,ugCC6E5BC,EAtEH,WACV,IAAIC,EAAMC,IAAMC,YADA,EAEGC,mBAAS,CAC1B,CACEC,KAAM,kBACNC,OAAQ,eACRC,IAAKC,IACLC,UAAW,mEAEb,CACEJ,KAAM,eACNC,OAAQ,eACRC,IAAKG,IACLD,UAAW,mEAEb,CACEJ,KAAM,gBACNC,OAAQ,eACRC,IAAKI,IACLF,UAAW,oEAjBRG,EAFS,sBAsBUR,mBAAS,GAtBnB,mBAsBTS,EAtBS,KAsBFC,EAtBE,OAuBkBV,oBAAS,GAvB3B,mBAuBTW,EAvBS,KAuBEC,EAvBF,KAyBVC,EAAO,WACXH,GAAUD,EAAQ,GAAKD,EAASM,SAE5BC,EAAW,WACfL,GAAUD,EAAQ,EAAID,EAASM,QAAUN,EAASM,SAGpDE,qBAAU,WACRC,QAAQC,IAAIP,GACRA,EACFQ,IAASC,YAAYvB,EAAIwB,SAASC,OAElCH,IAASC,YAAYvB,EAAIwB,SAASE,UAEnC,CAACZ,IACJK,qBAAU,WACRG,IAASC,YAAYvB,EAAIwB,SAASlB,IAAMK,EAASC,GAAON,IACtDqB,GAAgBC,EAAUjB,EAASC,GAAOJ,WAC5Cc,IAASC,YAAYvB,EAAIwB,SAASC,OAClCV,GAAa,KACZ,CAACH,IA7CY,MCGsB,SAACiB,EAAcC,EAAQC,EAASC,EAAYC,GAAW,QACxDhC,oBADwD,MACtF0B,EADsF,KACxEO,EADwE,KAEzFC,EAAJ,EACMC,EAASC,uBAH8E,UAI7FD,QAAeA,SAJ8E,IAK7F,IAAME,EAAQD,uBAL+E,SAM7FC,YAAkBF,EAN2E,gBAO7FE,WAIA,IAAMC,EAAS,6BAAG,sBAAAC,EAAA,0DACZH,SADY,wDAERA,SAAA,6BACE,WACJH,SAJU,6CAORN,EAPQ,0BAQRU,EAAA,gCACE,WACJJ,SAVU,2CAAH,qDAkBTN,EAAS,6BAAG,6BAAAY,EAAA,6DACZH,SAAJ,yBAAsCA,SADtB,uBAEhBF,EAFgB,GAIV3B,EAAY,IAJF,OAKhBA,eACAA,QANgB,SAOVA,EAPU,uBAQhB4B,uCARgB,eASVE,EATU,gCAUVA,EAVU,sEAAH,sDAiCf,OApBAG,yDAAyD,WACvD,GAAgBT,OAGlBS,qDAAqD,WACnD,GAAYR,OAGdQ,iDAAiD,WAC/C,GAAaV,IAETM,SAAJ,yBAAsCA,4CAGxCI,gDAAgD,WAC9C,GAAYX,IAERO,SAAJ,yBAAsCA,2CAGjC,CACLV,aADK,EAELY,UAFK,EAGLX,aDrB2Cc,CAAyB/B,EAASC,GAAOJ,WAAW,kBAAMO,GAAa,MAAO,kBAAMA,GAAa,KAAQG,EAAUF,GAAzJW,EA/CS,EA+CTA,aAAcY,EA/CL,EA+CKA,UAAWX,EA/ChB,EA+CgBA,UAEhC,OACE,yBAAKe,UAAU,aACb,8DACA,kCAAO,uBAAGC,OAAO,SAASC,KAAK,kCAAxB,iBACP,yBAAKC,MAAO,CAAEC,MAAO,SAAWzC,IAAKK,EAASC,GAAOJ,YACrD,2BAAOwC,QAAShC,EAAMhB,IAAKA,GACzB,4BAAQM,IAAKK,EAASC,GAAON,OAE/B,sDAAqBK,EAASC,GAAOP,OAArC,cAAiDM,EAASC,GAAOR,OACjE,yBAAKuC,UAAU,mBACb,4BAAQM,QAAS/B,GAAU,uBAAGyB,UAAU,kBAAb,kBAC3B,4BAAQM,QAAS,kBAAMlC,GAAcD,KAAaA,EAAY,uBAAG6B,UAAU,kBAAb,SAA0C,uBAAGA,UAAU,kBAAb,eACxG,4BAAQM,QAASjC,GAAM,uBAAG2B,UAAU,kBAAb,cACvB,6BACA,4BAAQM,QAASV,EAAWI,UAAU,WAAWhB,EAAe,+BAAiC,kDACjG,6BACA,uBAAGmB,MAAO,CAACI,SAAU,QAASN,OAAO,SAASC,KAAK,uCAAnD,oBElERM,IAASC,OAAO,kBAAC,EAAD,MAASf,SAASgB,eAAe,W","file":"static/js/main.44e36ec2.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/808s_stand_out.77bdd2c8.ogg\";","module.exports = __webpack_public_path__ + \"static/media/Kicking_away.3f33c968.mp3\";","module.exports = __webpack_public_path__ + \"static/media/Problems_away.1c600bca.flac\";","import React, { useState, useEffect } from 'react'\nimport ReactDom from 'react-dom'\nimport { useAudioPictureInPicture } from 'useaudiopictureinpicture'\nimport sound1 from './assets/sounds/808s_stand_out.ogg'\nimport sound2 from './assets/sounds/Kicking_away.mp3'\nimport sound3 from './assets/sounds/Problems_away.flac'\n\nconst App = () => {\n  let ref = React.createRef()\n  const [playList] = useState([\n    {\n      name: '808\\'s Stand out',\n      author: 'Thomas Cogez',\n      src: sound1,\n      thumbnail: 'https://i1.sndcdn.com/artworks-000568527800-jirbdh-t500x500.jpg'\n    },\n    {\n      name: 'Kicking away',\n      author: 'Thomas Cogez',\n      src: sound2,\n      thumbnail: 'https://i1.sndcdn.com/artworks-000584266589-finyvt-t200x200.jpg'\n    },\n    {\n      name: 'Problems away',\n      author: 'Thomas Cogez',\n      src: sound3,\n      thumbnail: 'https://i1.sndcdn.com/avatars-000533821485-ez22ce-t500x500.jpg'\n    }\n  ])\n  const [index, setIndex] = useState(0)\n  const [isPlaying, setIsPlaying] = useState(false)\n\n  const next = () => {\n    setIndex((index + 1) % playList.length)\n  }\n  const previous = () => {\n    setIndex((index - 1 + playList.length) % playList.length)\n  }\n\n  useEffect(() => {\n    console.log(isPlaying)\n    if (isPlaying) {\n      ReactDom.findDOMNode(ref.current).play()\n    } else {\n      ReactDom.findDOMNode(ref.current).pause()\n    }\n  }, [isPlaying])\n  useEffect(() => {\n    ReactDom.findDOMNode(ref.current).src = playList[index].src\n    { isPipToggled && updatePip(playList[index].thumbnail) }\n    ReactDom.findDOMNode(ref.current).play()\n    setIsPlaying(true)\n  }, [index])\n\n  const {isPipToggled, togglePip, updatePip} = useAudioPictureInPicture(playList[index].thumbnail, () => setIsPlaying(true), () => setIsPlaying(false), previous, next)\n\n  return (\n    <div className='container'>\n      <h1>React useAudioPictureInPicture</h1>\n      <h3>By <a target='_blank' href='https://github.com/Thomascogez'>Thomas Cogez</a></h3>\n      <img style={{ width: '200px' }} src={playList[index].thumbnail} />\n      <audio onEnded={next} ref={ref}>\n        <source src={playList[index].src} />\n      </audio>\n      <p>Now Playing : {`${playList[index].author} - ${playList[index].name}`}</p>\n      <div className='player-controls'>\n        <button onClick={previous}><i className='material-icons'>skip_previous</i></button>\n        <button onClick={() => setIsPlaying(!isPlaying)}>{isPlaying ? <i className='material-icons'>pause</i> : <i className='material-icons'>play_arrow</i>}</button>\n        <button onClick={next}><i className='material-icons'>skip_next</i></button>\n        <br />\n        <button onClick={togglePip} className='btn-pip'>{isPipToggled ? 'Hide Picture In Picture Mode' : 'Toggle Audio Player in Picture In Picture Mode'}</button>\n        <br />\n        <a style={{fontSize: '15px'}} target='_blank' href='https://soundcloud.com/thomas-cogez'>My SoundCloud</a>\n      </div>\n    </div>\n  )\n}\nexport default App","import * as React from 'react'\n\n/**\n * React hook that allow you to enable picture in picture mode on a music player\n * @param {*} initialImage          First Image to display in background of the pip frame (required)\n * @param {function} onPlay        function that would be triggered when the play btn is pressed\n * @param {function} onPause       function that would be triggered when the play btn is pressed\n * @param {function} onPrevious    function that would be triggered when the play btn is pressed\n * @param {function} onNext        function that would be triggered when the play btn is pressed\n */\nexport const useAudioPictureInPicture = (initialImage, onPlay, onPause, onPrevious, onNext) => {\n  const [isPipToggled, setIsToggled] = React.useState(false)\n  let thumb = initialImage\n  const canvas = document.createElement('canvas') // canvas element that would be display in the video element when pip mode is enable\n  canvas.width = canvas.height = 512 // default canvas height\n  const video = document.createElement('video') // create a new video element that would hold the canvas on pip mode\n  video.srcObject = canvas.captureStream() // get audio src from the page\n  video.muted = true\n  /**\n   * Toggle pip mode on screen if it's not already on\n   */\n  const togglePip = async () => {\n    if (document.pictureInPictureElement) {\n      await document.exitPictureInPicture()\n        .then(() => {\n          setIsToggled(false)\n        })\n    } else {\n      await updatePip(thumb)\n      await video.requestPictureInPicture() // go in PIP mode !!\n        .then(() => {\n          setIsToggled(true)\n        })\n    }\n  }\n  /**\n   * update the picture in picture background\n   * @param {*} image path of the new image\n   */\n  const updatePip = async (image) => {\n    if (document.pictureInPictureElement) document.exitPictureInPicture() // close previous one if set to avoid update glitch\n    thumb = image\n    // eslint-disable-next-line no-undef\n    const thumbnail = new Image() // thumbnail creation\n    thumbnail.crossOrigin = true\n    thumbnail.src = thumb\n    await thumbnail.decode()\n    canvas.getContext('2d').drawImage(thumbnail, 0, 0, 512, 512) // draw the image as the background of the canvas\n    await video.play()\n    await video.requestPictureInPicture()\n  }\n  // attach previous track btn on pip element\n  navigator.mediaSession.setActionHandler('previoustrack', () => {\n    if (onPrevious) onPrevious()\n  })\n  // attach next track btn on pip element\n  navigator.mediaSession.setActionHandler('nexttrack', () => {\n    if (onNext) onNext()\n  })\n  // attach pause track btn on pip element\n  navigator.mediaSession.setActionHandler('pause', () => {\n    if (onPause) onPause()\n    // set pause state on pip frame\n    if (document.pictureInPictureElement) document.pictureInPictureElement.pause()\n  })\n  // attach play track btn on pip element\n  navigator.mediaSession.setActionHandler('play', () => {\n    if (onPlay) onPlay()\n    // set play state on pip frame\n    if (document.pictureInPictureElement) document.pictureInPictureElement.play()\n  })\n\n  return {\n    isPipToggled,\n    togglePip,\n    updatePip\n  }\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\n\nimport './index.css'\nimport App from './App'\n\nReactDOM.render(<App />, document.getElementById('root'))\n"],"sourceRoot":""}